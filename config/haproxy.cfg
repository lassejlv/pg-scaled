global
    daemon
    maxconn 256
    log stdout local0

defaults
    mode tcp
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option tcplog
    option dontlognull
    retries 3

# Statistics interface
listen stats
    bind *:8080
    mode http
    stats enable
    stats uri /stats
    stats refresh 30s
    stats hide-version
    stats auth admin:admin

# PostgreSQL Primary (Write operations)
frontend postgres_write
    bind *:5001
    default_backend postgres_primary

backend postgres_primary
    balance roundrobin
    server postgres-primary postgres-primary:5432 check inter 2000 rise 2 fall 3

# PostgreSQL Read Load Balancer (Read operations)
frontend postgres_read
    bind *:5000
    default_backend postgres_replicas

backend postgres_replicas
    balance roundrobin
    server postgres-replica-1 postgres-replica-1:5432 check inter 2000 rise 2 fall 3
    server postgres-replica-2 postgres-replica-2:5432 check inter 2000 rise 2 fall 3
    server postgres-primary postgres-primary:5432 check inter 2000 rise 2 fall 3 backup
